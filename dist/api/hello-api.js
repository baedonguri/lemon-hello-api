"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports=module.exports=function(i,e){if(!i)throw new Error("_$(global instance pool) is required!");i._;var p=i.U;if(!p)throw new Error("$U is required!");var h=p.NS(e||"GOOD","yellow"),y=i.log,m=(i.inf,i.err);function b(e){return E(404,e)}function v(e){return E(503,e)}function E(e,t){return{statusCode:e,headers:{"Content-Type":"string"==typeof t?"text/plain; charset=utf-8":"application/json; charset=utf-8","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:"string"==typeof t?t:JSON.stringify(t)}}var t=function(e,t,r){t.callbackWaitsForEmptyEventLoop=!1;var o=e.queryStringParameters||{},n=e.pathParameters||{},i=decodeURIComponent(n.type||""),s=decodeURIComponent(n.id||""),l=(s||"GET"!==e.httpMethod?e.httpMethod:"LIST")||"",c=decodeURIComponent(n.cmd||e.action||""),a=l&&{LIST:"LIST",GET:"GET",PUT:"PUT",POST:"POST",DELETE:"DELETE"}[l]||(e.Records?"EVENT":e.Sns?"SNS":"CRON"),u=e.body&&("string"==typeof e.body&&(e.body.startsWith("{")||e.body.startsWith("["))?JSON.parse(e.body):e.body)||e.Records&&{records:e.Records}||null;!u&&y(h,"#"+a+":"+c+" ("+l+", "+i+"/"+s+")...."),u&&y(h,"#"+a+":"+c+" ("+l+", "+i+"/"+s+").... body.len=",u?p.json(u).length:-1);var d={_id:s,_param:o,_body:u,_event:e,_ctx:t};d._ctx=e&&e.requestContext||d._ctx;var f=Promise.resolve(d),_=function(e,t,r){var o=null;switch(e){case"LIST":o=T;break;case"GET":o=g;break;case"PUT":o=S;break;case"POST":o=O;break;case"DELETE":o=P}return o}(a);if(!_)return r(null,b({MODE:a}));try{f.then(function(e){var t=e._id,r=e._param,o=e._body,n=e._ctx;return _(t,r,o,n)}).then(function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&(e=p.cleanup(e)),r(null,E(200,e)),!0}).catch(function(e){return m(h,"!!! callback@1 with err",e),0<=(e&&e.message||"").indexOf("404 NOT FOUND")?r(null,b(e.message)):r(null,v(e.message||e)),!1})}catch(e){r(e,v(e.message))}};t.do_list_hello=T,t.do_get_hello=g,t.do_put_hello=S,t.do_post_hello=O,t.do_delete_hello=P;var s=[{name:"lemon"},{name:"cloud"}];function T(e,t,r,o){y(h,"do_list_hello("+e+")....");var n={};return n.name=i.environ("NAME"),Promise.resolve(n).then(function(e){return e.list=s,e})}function g(e,t,r,o){y(h,"do_get_hello("+e+")....");var n=p.N(e,0),i=s[n];return i?Promise.resolve(i).then(function(e){var t=Object.assign({},e);return t._id=n,t}):Promise.reject(new Error("404 NOT FOUND - id:"+n))}function S(e,t,r,o){return y(h,"do_put_hello("+e+")...."),t=t||{},g(e).then(function(e){var t=e._id;return Object.assign(s[t],r||{}),Object.assign(e,r||{})})}function O(e,t,r,o){return y(h,"do_post_hello("+e+")...."),t=t||{},r||r.name?Promise.resolve(r).then(function(e){return s.push(e),s.length-1}):Promise.reject(new Error(".name is required!"))}function P(e,t,r,o){return y(h,"do_delete_hello("+e+")...."),g(e).then(function(e){var t=e._id;return void 0===t?Promise.reject(new Error("._id is required!")):(delete s[t],e)})}return t};